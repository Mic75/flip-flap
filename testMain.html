<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
  <head>
    <title>Split-flap test page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <style>
      @import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:700,400);

      .wrapper {
        display: flex;
        flex-direction: row;
        justify-content: center;
        height: 750px;
      }

      section {
        border: solid 3px grey;
        vertical-align: top;
        border-radius: 5px;
        padding: 20px;
        margin: 10px 5px 0 0;
        font: 700 1em "Roboto", sans-serif;
      }
      #split-flap {
        margin: auto;
        width: 700px;
      }

      #controls {
        width: 300px;
        margin:auto;
        text-align: center;
      }

      #controls input {
        border: none;
        width: 2em;
      }
      
      #clock {
        font-size: 5em;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <section id="3d-view">
        <div id="split-flap"></div>
        <div id="controls">
          <div>
            <label for="row">Row: </label>
            <input type="text" id="row" readonly>
            <div id="slider-row"></div>
          </div>
          <div>
            <label for="column">Column: </label>
            <input type="text" id="column" readonly>
            <div id="slider-column"></div>
          </div>
          <div>
            <label for="speed">Speed: </label>
            <input type="text" id="speed" readonly>
            <div id="slider-speed"></div>
          </div>
        </div>
      </section>
      <section>
        <div>
          <h1>Inputs:</h1>
          <div id="inputs">
            <p id="clock"></p>
          </div>
        </div>
      </section>
    </div>


    <script src="js/require.js"></script>
    <script>
      require.config({
        baseUrl: "js"
      });

      require(["split-flap", "jquery", "jquery-ui"], function(split_flap, $) {

//        var button = document.getElementById("generate");
//        button.addEventListener("click", function() {
//          var col, row, i, speed, inputsDiv, container, j;
//
//          function getValue(name, defaultVal) {
//            var val = parseFloat(document.getElementById(name).value);
//            return (isNaN(val) ? defaultVal : val);
//          }
//
//          col = getValue("col", 6);
//          row = getValue("row", 3);
//          speed = getValue("speed", 20);
//
//          container = document.createElement("div");
//          document.body.appendChild(container);
//
//          //create the split-flap display
//          splitFlap.create(container, {col: col, row: row, speed: speed});
//
//          //add the input field to manipulate the split-flap
//          inputsDiv = document.createElement("div");
//          for (i = 0; i < row; i++) {
//            var fieldContainer = document.createElement("p");
//            var inputField = document.createElement("input");
//            inputField.type = "text";
//
//            (function(i) {
//              inputField.addEventListener("change", function(e) {
//                for (j = 0; j < col; j++) {
//                  splitFlap.set(i, j, e.target.value.charAt(j));
//                }
//              }, false);
//            })(i);
//
//            fieldContainer.appendChild(inputField);
//            inputsDiv.appendChild(fieldContainer);
//            document.body.appendChild(inputsDiv);
//          }
//
//        }, false);
        
        var $split_flap = $("#split-flap"),
            row = 1, col = 8, speed = 5;
        
        function reset_split_flap (){
          
          $split_flap.empty();
          if (clock_animation !== null){
            cancelAnimationFrame(clock_animation);
          }
          split_flap.create($split_flap.get(0), {col: col, row: row, speed: speed, width: 700});
        }
        
        var sliders = {
          row: {
            min: 1, 
            max: 10, 
            value: row, 
            slide: function(event, ui) {
              row = ui.value;
              reset_split_flap();
              $("#row").val(row);
            }
          },
          column: {
            min: 1, 
            max: 10, 
            value: col,
            slide : function(event, ui) {
              col = ui.value;
              reset_split_flap();
              $("#column").val(col);
            }
          },
          speed: {
            min: 1, 
            max: 10, 
            value: speed,
            slide: function(event, ui) {
              speed = ui.value;
              split_flap.setSpeed(speed);
              $("#speed").val(ui.value);
            }
          }
        };

        for (var id in sliders) {
          if (sliders.hasOwnProperty(id)) {
            $("#slider-" + id).slider({
              range: "max",
              min: sliders[id].min,
              max: sliders[id].max,
              value: sliders[id].value,
              slide: sliders[id].slide
            });
          }
          $("#"+id).val(sliders[id].value);
        }

        split_flap.create($split_flap.get(0), {
          col: col,
          row: row,
          speed: speed,
          width: 700});

        var started = true,
                clock_animation = null,
                elapsed = 0;
        
        function update_clocks() {
          var time_text = new Date(Date.now()).toLocaleTimeString('fr-FR'),
              i = null;
                      
          for (i=0; i < time_text.length;i++){
            if (time_text[i] !== ':') {
              split_flap.set( 0,i,time_text[i], {numeric: true} );
            }
          }
          $("#clock").text(time_text);
        }

        function tick() {
          if (Date.now() - elapsed > 1000) {
            update_clocks();
            elapsed = Date.now();
          }

          if (started) {
            clock_animation = requestAnimationFrame(tick);
          }
        }
        clock_animation = requestAnimationFrame(tick);


      });
    </script>
  </body>
</html>
