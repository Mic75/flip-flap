<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
  <head>
    <title>Split-flap test page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/jquery-ui.css">
    <style>
      @import url(http://fonts.googleapis.com/css?family=Roboto+Condensed:700,400);

      .wrapper {
        display: flex;
        flex-direction: row;
        justify-content: center;
        height: 750px;
      }

      section {
        border: solid 3px grey;
        vertical-align: top;
        border-radius: 5px;
        padding: 20px;
        margin: 10px 5px 0 0;
        font: 700 1em "Roboto", sans-serif;
      }
      #split-flap {
        margin: auto;
        width: 700px;
      }

      #controls {
        width: 300px;
        margin:auto;
        text-align: center;
      }

      #controls input {
        border: none;
        width: 2em;
      }
      
      #clock {
        font-size: 5em;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <section id="3d-view">
        <div id="split-flap"></div>
        <div id="controls">
          <div>
            <label for="row">Row: </label>
            <input type="text" id="row" readonly>
            <div id="slider-row"></div>
          </div>
          <div>
            <label for="column">Column: </label>
            <input type="text" id="column" readonly>
            <div id="slider-column"></div>
          </div>
          <div>
            <label for="speed">Speed: </label>
            <input type="text" id="speed" readonly>
            <div id="slider-speed"></div>
          </div>
        </div>
      </section>
      <section>
        <div>
          <h1>Inputs:</h1>
          <div id="inputs">
            <p id="clock"></p>
          </div>
        </div>
      </section>
    </div>


    <script src="js/require.js"></script>
    <script>
      require.config({
        baseUrl: "js"
      });

      require(["split-flap", "jquery", "jquery-ui"], function(split_flap, $) {

//        var button = document.getElementById("generate");
//        button.addEventListener("click", function() {
//          var col, row, i, speed, inputsDiv, container, j;
//
//          function getValue(name, defaultVal) {
//            var val = parseFloat(document.getElementById(name).value);
//            return (isNaN(val) ? defaultVal : val);
//          }
//
//          col = getValue("col", 6);
//          row = getValue("row", 3);
//          speed = getValue("speed", 20);
//
//          container = document.createElement("div");
//          document.body.appendChild(container);
//
//          //create the split-flap display
//          splitFlap.create(container, {col: col, row: row, speed: speed});
//
//          //add the input field to manipulate the split-flap
//          inputsDiv = document.createElement("div");
//          for (i = 0; i < row; i++) {
//            var fieldContainer = document.createElement("p");
//            var inputField = document.createElement("input");
//            inputField.type = "text";
//
//            (function(i) {
//              inputField.addEventListener("change", function(e) {
//                for (j = 0; j < col; j++) {
//                  splitFlap.set(i, j, e.target.value.charAt(j));
//                }
//              }, false);
//            })(i);
//
//            fieldContainer.appendChild(inputField);
//            inputsDiv.appendChild(fieldContainer);
//            document.body.appendChild(inputsDiv);
//          }
//
//        }, false);

        var conf = {
          row: {min: 1, max: 10, value: 1},
          column: {min: 1, max: 10, value: 8},
          speed: {min: 1, max: 20, value: 5}
        };

        for (var id in conf) {
          if (conf.hasOwnProperty(id)) {
            $("#slider-" + id).slider({
              range: "max",
              min: conf[id].min,
              max: conf[id].max,
              value: conf[id].value,
              slide: (function(id) {
                return function(event, ui) {
                  $("#" + id).val(ui.value);
                };
              })(id)
            });
            $("#" + id).val($("#slider-" + id).slider("value"));
          }
        }

        split_flap.create($("#split-flap").get(0), {
          col: conf.column.value,
          row: conf.column.row,
          speed: conf.column.speed,
          width: 700});

        var started = true,
                animation_id = null,
                elapsed = 0;

        function update_clock() {
          var current_date = new Date(Date.now()),
                  seconds = current_date.getSeconds() > 9 ? current_date.getSeconds() : "0" + current_date.getSeconds();
          $("#clock").text(current_date.getHours() + ":" + current_date.getMinutes() + ":" + seconds);
        }

        function tick() {
          if (Date.now() - elapsed > 1000) {
            update_clock();
            elapsed = Date.now();
          }

          if (started) {
            requestAnimationFrame(tick);
          }
        }
        animation_id = requestAnimationFrame(tick);


      });
    </script>
  </body>
</html>
